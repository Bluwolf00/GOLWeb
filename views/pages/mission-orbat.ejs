<!doctype html>
<html lang="en" data-bs-theme="dark">

<head>
    <%- include('../partials/head', {pageTitle: "GOL Slot Selector"}) %>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-org-chart@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.1.2/build/d3-flextree.js"></script>

    <style>
        .node-bubble {
            transition: all 0.3s ease;
        }

        .selected-bubble {
            border: 3px solid var(--bs-primary) !important;
            box-shadow: 0 0 10px rgba(0, 132, 255, 0.5);
        }
    </style>
</head>

<%- include('../partials/headernav', {pageTitle: "Orbat", loggedin: userLogged, username: username}) %>

<body>
    <main>
        <div class="container my-5">
            <div class="row text-center">
                <h1>SLOT SELECTION</h1>
                <h3 id="missionDateTimeLbl"></h3>
                <p class="text-muted">Please select your
                    <% if (selectedOption === "slots") { %>
                    <strong>slot</strong>
                    <% } else { %>
                    <strong>role</strong>
                    <% } %>
                    before the operation starts.</p>

            </div>
            <div class="row text-center">
                <div class="col"><button id="exportBtn" class="btn btn-primary">Export to PNG</button></div>
            </div>

            <div class="chart-container" id="orgChart"></div>

            <div class="container text-center">
                <p class="text-muted mt-3">Disclaimer: These slots only indicate a preference and leaders hold the right to
                    move players into other slots.</p>
                <form id="orbatSelectForm" method="POST" action="/data/orbatSubmission">
                    <% if (selectedOption != "view") { %>
                    <div class="row justify-content-center my-5 text-center">
                        <div class="col-sm-3">
                            <h3>Selected Member</h3>
                            <p class="text-muted">Only leaders, moderators and admins can assign other members.
                            </p>
                            <select id="memberSelect" class="form-select" name="selectedMember">
                            </select>
                            <% if (selectedOption === "slots") { %>
                            <div class="form-group" style="margin-top: 1rem;">
                                <label for="unassign" class="form-text" style="color: var(--blu-secondary);">Unassign
                                    Member?</label>
                                <input type="checkbox" name="unassign" id="unassign" value="off"
                                    class="form-check-input">
                            </div>
                            <div class="form-group">
                                <label for="lock" class="form-text" style="color: var(--blu-secondary);">Lock
                                    Slot?</label>
                                <input type="checkbox" name="lock" id="lock" value="off"
                                    class="form-check-input">
                            </div>
                            <% } %>
                        </div>

                        <% if (selectedOption === "roles") { %>
                        <div class="col-sm-3">
                            <h3>Selected Role</h3>
                            <div class="text-muted">Please select one of the roles from the dropdown:</div>
                            <select name="chosen_role" id="roleSelect" class="form-select mt-3">
                                <option value="" selected disabled>Select a role</option>
                                <option value="NONE" style="color: red;">Unassign Role</option>
                                <optgroup label="=== Any Role Groups ===" id="anyRoleGroup">
                                    <!-- <option value="Any Role" style="color: deepskyblue;">Any Role</option> -->
                                    <option value="Any Basic" style="color: red;">Any Basic Role</option>
                                    <option value="Any Leader" style="color: grey;" id="anyLeadershipOption" disabled>
                                        Any Leadership Role</option>
                                    <option value="Any Support" style="color: yellow;">Any Support Role</option>
                                </optgroup>
                                <optgroup label="=== Leadership Roles ===" id="leadershipRoleGroup" disabled>
                                    <option value="Platoon Leader" style="color: grey;">Platoon Leader</option>
                                    <option value="Crew Commander" style="color: grey;">Crew Commander</option>
                                    <option value="Squad Leader" style="color: grey;">Squad Leader</option>
                                    <option value="Fire Team Leader" style="color: grey;">Fire Team Leader</option>
                                </optgroup>

                                <optgroup label="=== Basic Roles ===" id="basicRoleGroup">
                                    <option value="Rifleman" style="color: red;">Rifleman</option>
                                    <option value="Grenadier" style="color: red;">Grenadier</option>
                                    <option value="Assistant Gunner" style="color: deepskyblue;">Asst. Gunner</option>
                                    <option value="Automatic Rifleman" style="color: deepskyblue;">Automatic Rifleman
                                    </option>
                                </optgroup>

                                <optgroup label="=== Crew Roles ===" id="crewRoleGroup">
                                    <option value="Crew Driver" style="color: yellow;">Crew Driver</option>
                                    <option value="Crew Gunner" style="color: yellow;">Crew Gunner</option>
                                </optgroup>

                                <optgroup label="=== Specialist Roles ===" id="specialistRoleGroup">
                                    <option value="Pilot" style="color: deepskyblue;">Pilot</option>
                                    <option value="FAC" style="color: deepskyblue;">Forward Air Controller</option>
                                    <option value="Squad Medic" style="color: yellow;">Squad Medic</option>
                                    <option value="Platoon Medic" style="color: yellow;">Platoon Medic</option>
                                    <option value="CSW Operator" style="color: yellow;">CSW Operator</option>
                                    <option value="Light Rifleman" style="color: yellow;">Light Rifleman</option>
                                    <option value="Ammo Bearer" style="color: yellow;">Ammo Bearer</option>
                                </optgroup>
                            </select>
                        </div>
                        <% } %>
                    </div>
                    <p class="lead">Select your slot for the next operation.</p>
                    <p class="text-muted">If you have any issues, please contact a moderator.</p>
                    <% } else { %>
                    <p class="lead">View the current ORBAT for the next operation.</p>
                    <% } %>
                    <div class="row justify-content-center">
                        <div class="col-sm-2">
                            <% if (selectedOption != "view") { %>
                            <button type="submit" class="btn btn-primary mt-3 mx-2">Submit</button>
                            <% } %>
                            <a href="/mission-orbat/select"><button type="button"
                                    class="btn btn-secondary mt-3">Back</button></a>
                        </div>
                    </div>
                    <% if (selectedOption === "slots") { %>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-check">
                                <input type="text" name="chosen_slot" id="chosenSlotNodeID" value=""
                                    style="display: none;">
                            </div>
                            <div class="form-check">
                                <input type="text" name="chosen_role" id="chosenSlotRoleName" value=""
                                    style="display: none;">
                            </div>
                        </div>
                    </div>
                    <% } %>
                </form>
            </div>
    </main>

    <script defer>
        var isloggedIn = "<%= loggedin %>"
    </script>
    <script src="/scripts/checkLogged.js"></script>

    <script src="/scripts/orbatchart.js"></script>

    <footer>
        <%- include('../partials/footer') %>
    </footer>
</body>

</html>